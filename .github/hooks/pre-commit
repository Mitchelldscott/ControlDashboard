#!/usr/bin/env bash
# Pre-commit hook to format Julia code automatically

set -e

echo "ðŸ”§ Running JuliaFormatter..." >&2

# Ensure weâ€™re in repo root (in case of partial commits)
cd "$(git rev-parse --show-toplevel)"

# Run JuliaFormatter with your configuration
julia --color=yes -e '
using Pkg; Pkg.activate("."); 
Pkg.instantiate();
using JuliaFormatter;
if !format(".", verbose=true)
    @info "Package automatically formatted"
end
'

# Add any newly formatted files back to the commit
if [[ -n $(git diff --name-only) ]]; then
    echo "âœ¨ Re-adding formatted files..." >&2
    git add $(git diff --name-only)
fi

echo "âœ… Formatting done. Proceeding with commit." >&2
